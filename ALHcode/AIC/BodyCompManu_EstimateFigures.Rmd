---
title: "BodyCompManu_EstimateFigures"
author: "Abby Host"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Run Timing Group Coefficient Plots
```{r, include = FALSE}
library(dplyr)
library(ggplot2)

rm(list = ls())
#body size, energy, total energy side by side
body <- read.csv("bodysize_runtiminggroup/bodysize~runtiminggroup_models_CoefEstimates_withLikelihoods.csv")
energy_mJkg <- read.csv("energydensity_runtiminggroup/EnergyPDry_1~runtiminggroup_models_CoefEstimates_withLikelihoods.csv")
energy_mJ <- read.csv("totalenergy_runtiminggroup/TotalEnergy~runtiminggroup_models_CoefEstimates_withLikelihoods.csv")



#Look at structure
str(body)
str(energy_mJ)
str(energy_mJkg)

levels(factor(body$X))
body$X <- factor(body$X,
                 levels = rev(c("(Intercept)", 
                                      "Collection_RiverMile_m",
                                      "RunTimingGroupMiddle", 
                                      "RunTimingGroupLate", 
                                      "SexM",
                                      "Year2020",
                                      "Year2021",
                                      "RunTimingGroupMiddle:SexM",
                                      "RunTimingGroupLate:SexM",
                                      "SexM:Year2020",
                                      "SexM:Year2021")))

levels(factor(energy_mJ$X))
energy_mJ$X <- factor(energy_mJ$X,
                 levels = rev(c("(Intercept)", 
                                      "Collection_RiverMile_m",
                                      "RunTimingGroupMiddle", 
                                      "RunTimingGroupLate", 
                                      "SexM",
                                      "Year2020",
                                      "Year2021",
                                      "RunTimingGroupMiddle:SexM",
                                      "RunTimingGroupLate:SexM",
                                      "SexM:Year2020",
                                      "SexM:Year2021")))

levels(factor(energy_mJkg$X))
energy_mJkg$X <- factor(energy_mJkg$X,
                 levels = rev(c("(Intercept)", 
                                      "Collection_RiverMile_m",
                                      "RunTimingGroupMiddle", 
                                      "RunTimingGroupLate", 
                                      "SexM",
                                      "Year2020",
                                      "Year2021",
                                      "RunTimingGroupMiddle:SexM",
                                      "RunTimingGroupLate:SexM",
                                      "SexM:Year2020",
                                      "SexM:Year2021")))


#now data has been restructured for figures, need to remove collection river mile from all structure, does not need to be graphed
body <- body %>%
  filter(X != "Collection_RiverMile_m")
energy_mJ <- energy_mJ %>%
  filter(X != "Collection_RiverMile_m")
energy_mJkg <- energy_mJkg %>%
  filter(X != "Collection_RiverMile_m")


#combine data set according to metric
# Add a variable for dataset type
body$Trait <- "Body size"
energy_mJkg$Trait <- "Energy density"
energy_mJ$Trait <- "Total energy"

# Combine all
AllData <- bind_rows(body, energy_mJkg, energy_mJ)

# Optional: order Trait for facet order
AllData$Trait <- factor(AllData$Trait, levels = c("Body size", "Energy density", "Total energy"))

colors <- c(
  "#E69F00", # orange
  "#56B4E9", # sky blue
  "#009E73", # bluish green
  "#F0E442", # yellow
  "#0072B2", # blue
  "#D55E00", # vermillion
  "#CC79A7", # reddish purple
  "#999999"  # gray
)

#plot, basic
coef_plot <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 3) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 3) +
  geom_point(aes(fill = Trait), size = 6, shape = 21, color = "black") +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +  # âœ… call with namespace
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")  # âœ… more space between facets
  )

coef_plot


#plot, coefficients highlighted that don't intersect zero
AllData <- AllData %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))
coef_plot1 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 4, shape = 21, color = "black") +
  # ðŸ”´ Add red circle highlights
  geom_point(
    data = subset(AllData, sig == TRUE),
    aes(x = Avg_Coef, y = X),
    shape = 21, fill = NA, color = "red", size = 6, stroke = 1
  ) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")
  )

coef_plot1


#better formatting, eliminate interactions
AllData <- AllData %>%
  filter(!grepl(":", X))
coef_plot2 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 2) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 2) +
  geom_point(aes(fill = Trait), size = 7, shape = 21, color = "black") +
  # ðŸ”´ Add red circle highlights
  geom_point(
    data = subset(AllData, sig == TRUE),
    aes(x = Avg_Coef, y = X),
    shape = 21, fill = NA, color = "red", size = 10, stroke = 1
  ) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    # ðŸ–¤ Facet header (strip) styling
    strip.text = element_text(size = 22, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    
    # ðŸª¶ General text/axes
    axis.text = element_text(size = 20, color = "black"),
    axis.title = element_text(size = 24, face = "bold"),
    
    # ðŸ§± Panel outlines
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    
    # Grid + spacing tweaks
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    
    # Remove legend
    legend.position = "none"
  )

coef_plot2


# Save coef_plot2 as a jpeg
#ggsave(
 # filename = "coef_plot2.jpeg",    # output file name
#  plot = coef_plot2,              # the ggplot object
 # width = 12,                     # width in inches
#  height = 6,                    # height in inches
 # dpi = 300                        # resolution (higher = better quality)
#)
```


#Genetic Stock Coefficient Plots
```{r, include = FALSE}
library(dplyr)
library(ggplot2)

rm(list = ls())
#body size, energy, total energy side by side
body <- read.csv("bodysize_GSI/bodysize_GSI_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJkg <- read.csv("energydensity_GSI/EnergyPDry_1_GSI_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJ <- read.csv("totalenergy_GSI/TotalEnergy_GSI_ModelAvg_Coefs_withLikelihoods.csv")



#Look at structure
str(body)
str(energy_mJ)
str(energy_mJkg)

levels(factor(body$X))
body$X <- factor(body$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "Group_AssignmentChitina",
                                "Group_AssignmentGulkana",
                                "Group_AssignmentGulkanaHatchery",
                                "Group_AssignmentKlutinaLake",
                                "Group_AssignmentKlutinaTonsinaOutlet",
                                "Group_AssignmentSlana",
                                "Group_AssignmentTanadaCopperLakes",
                                "Group_AssignmentTazlina",
                                "SexM")))

levels(factor(energy_mJ$X))
energy_mJ$X <- factor(energy_mJ$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "Group_AssignmentChitina",
                                "Group_AssignmentGulkana",
                                "Group_AssignmentGulkanaHatchery",
                                "Group_AssignmentKlutinaLake",
                                "Group_AssignmentKlutinaTonsinaOutlet",
                                "Group_AssignmentSlana",
                                "Group_AssignmentTanadaCopperLakes",
                                "Group_AssignmentTazlina",
                                "SexM")))

levels(factor(energy_mJkg$X))
energy_mJkg$X <- factor(energy_mJkg$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "Group_AssignmentChitina",
                                "Group_AssignmentGulkana",
                                "Group_AssignmentGulkanaHatchery",
                                "Group_AssignmentKlutinaLake",
                                "Group_AssignmentKlutinaTonsinaOutlet",
                                "Group_AssignmentSlana",
                                "Group_AssignmentTanadaCopperLakes",
                                "Group_AssignmentTazlina",
                                "SexM")))


#now data has been restructured for figures, need to remove collection river mile from all structure, does not need to be graphed
body <- body %>%
  filter(X != "Collection_RiverMile_m")
energy_mJ <- energy_mJ %>%
  filter(X != "Collection_RiverMile_m")
energy_mJkg <- energy_mJkg %>%
  filter(X != "Collection_RiverMile_m")


#combine data set according to metric
# Add a variable for dataset type
body$Trait <- "Body size"
energy_mJkg$Trait <- "Energy density"
energy_mJ$Trait <- "Total energy"

# Combine all
AllData <- bind_rows(body, energy_mJkg, energy_mJ)

# Optional: order Trait for facet order
AllData$Trait <- factor(AllData$Trait, levels = c("Body size", "Energy density", "Total energy"))

colors <- c(
  "#E69F00", # orange
  "#56B4E9", # sky blue
  "#009E73", # bluish green
  "#F0E442", # yellow
  "#0072B2", # blue
  "#D55E00", # vermillion
  "#CC79A7", # reddish purple
  "#999999"  # gray
)

#plot, basic
coef_plot <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 3, shape = 21, color = "black") +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +  # âœ… call with namespace
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")  # âœ… more space between facets
  )

coef_plot


#plot, coefficients highlighted that don't intersect zero
AllData <- AllData %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))
coef_plot1 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 4, shape = 21, color = "black") +
  # ðŸ”´ Add red circle highlights
 geom_point(
  data = subset(AllData, sig == TRUE & X != "(Intercept)"),
  aes(x = Avg_Coef, y = X),
  shape = 21, fill = NA, color = "red", size = 6, stroke = 1
) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")
  )

coef_plot1


#better formatting, eliminate interactions
coef_plot2 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 2) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 2) +
  geom_point(aes(fill = Trait), size = 7, shape = 21, color = "black") +
  # ðŸ”´ Add red circle highlights
  geom_point(
  data = subset(AllData, sig == TRUE & X != "(Intercept)"),
  aes(x = Avg_Coef, y = X),
  shape = 21, fill = NA, color = "red", size = 10, stroke = 1
) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    # ðŸ–¤ Facet header (strip) styling
    strip.text = element_text(size = 22, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    
    # ðŸª¶ General text/axes
    axis.text = element_text(size = 20, color = "black"),
    axis.title = element_text(size = 24, face = "bold"),
    
    # ðŸ§± Panel outlines
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    
    # Grid + spacing tweaks
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    
    # Remove legend
    legend.position = "none"
  )

coef_plot2


# Save coef_plot2 as a jpeg
ggsave(
  filename = "coef_plot2.jpeg",    # output file name
  plot = coef_plot2,              # the ggplot object
  width = 18,                     # width in inches
  height = 12,                    # height in inches
  dpi = 300                        # resolution (higher = better quality)
)
```


#Collection Location Coefficient Plots
```{r, include = FALSE}
library(dplyr)
library(ggplot2)

rm(list = ls())
#body size, energy, total energy side by side
body <- read.csv("bodysize_spawningpopulation/bodysize_spawningpopulation_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJkg <- read.csv("energydensity_spawningpopulation/energydensity_spawningpopulation_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJ <- read.csv("totalenergy_spawningpopulation/TotalEnergy_SP_ModelAvg_Coefs_withLikelihoods.csv")



```

