---
title: "BodyCompManu_EstimateFigures"
author: "Abby Host"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Run Timing Group Coefficient Plots
```{r, include = FALSE}
library(dplyr)
library(ggplot2)

rm(list = ls())
#body size, energy, total energy side by side
body <- read.csv("bodysize_runtiminggroup/bodysize~runtiminggroup_models_CoefEstimates_withLikelihoods.csv")
energy_mJkg <- read.csv("energydensity_runtiminggroup/EnergyPDry_1~runtiminggroup_models_CoefEstimates_withLikelihoods.csv")
energy_mJ <- read.csv("totalenergy_runtiminggroup/TotalEnergy~runtiminggroup_models_CoefEstimates_withLikelihoods.csv")



#Look at structure
str(body)
str(energy_mJ)
str(energy_mJkg)

levels(factor(body$X))
body$X <- factor(body$X,
                 levels = rev(c("(Intercept)", 
                                      "Collection_RiverMile_m",
                                      "RunTimingGroupMiddle", 
                                      "RunTimingGroupLate", 
                                      "SexM",
                                      "Year2020",
                                      "Year2021",
                                      "RunTimingGroupMiddle:SexM",
                                      "RunTimingGroupLate:SexM",
                                      "SexM:Year2020",
                                      "SexM:Year2021")))

levels(factor(energy_mJ$X))
energy_mJ$X <- factor(energy_mJ$X,
                 levels = rev(c("(Intercept)", 
                                      "Collection_RiverMile_m",
                                      "RunTimingGroupMiddle", 
                                      "RunTimingGroupLate", 
                                      "SexM",
                                      "Year2020",
                                      "Year2021",
                                      "RunTimingGroupMiddle:SexM",
                                      "RunTimingGroupLate:SexM",
                                      "SexM:Year2020",
                                      "SexM:Year2021")))

levels(factor(energy_mJkg$X))
energy_mJkg$X <- factor(energy_mJkg$X,
                 levels = rev(c("(Intercept)", 
                                      "Collection_RiverMile_m",
                                      "RunTimingGroupMiddle", 
                                      "RunTimingGroupLate", 
                                      "SexM",
                                      "Year2020",
                                      "Year2021",
                                      "RunTimingGroupMiddle:SexM",
                                      "RunTimingGroupLate:SexM",
                                      "SexM:Year2020",
                                      "SexM:Year2021")))


#now data has been restructured for figures, need to remove collection river mile from all structure, does not need to be graphed
body <- body %>%
  filter(X != "Collection_RiverMile_m")
energy_mJ <- energy_mJ %>%
  filter(X != "Collection_RiverMile_m")
energy_mJkg <- energy_mJkg %>%
  filter(X != "Collection_RiverMile_m")


#combine data set according to metric
# Add a variable for dataset type
body$Trait <- "Body size"
energy_mJkg$Trait <- "Energy density"
energy_mJ$Trait <- "Total energy"

# Combine all
AllData <- bind_rows(body, energy_mJkg, energy_mJ)

# Optional: order Trait for facet order
AllData$Trait <- factor(AllData$Trait, levels = c("Body size", "Energy density", "Total energy"))
str(AllData)
levels(AllData$X)[levels(AllData$X) == "RunTimingGroupLate"] <- "Late Run Timing Group"
levels(AllData$X)[levels(AllData$X) == "RunTimingGroupMiddle"] <- "Middle Run Timing Group"
levels(AllData$X)[levels(AllData$X) == "SexM"] <- "Male"
levels(AllData$X)[levels(AllData$X) == "Year2020"] <- "2020"
levels(AllData$X)[levels(AllData$X) == "Year2021"] <- "2021"
AllData

colors <- c(
  "#E69F00", # orange
  "#56B4E9", # sky blue
  "#009E73", # bluish green
  "#F0E442", # yellow
  "#0072B2", # blue
  "#D55E00", # vermillion
  "#CC79A7", # reddish purple
  "#999999"  # gray
)

#plot, basic
coef_plot <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 3) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 3) +
  geom_point(aes(fill = Trait), size = 6, shape = 21, color = "black") +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +  # âœ… call with namespace
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")  # âœ… more space between facets
  )

coef_plot


#plot, coefficients highlighted that don't intersect zero
AllData <- AllData %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))
coef_plot1 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 4, shape = 21, color = "black") +
  # ðŸ”´ Add red circle highlights
  geom_point(
    data = subset(AllData, sig == TRUE),
    aes(x = Avg_Coef, y = X),
    shape = 21, fill = NA, color = "red", size = 6, stroke = 1
  ) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")
  )

coef_plot1

library(stringr)

#better formatting, eliminate interactions
AllData <- AllData %>%
  filter(!grepl(":", X))
coef_plot2 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 3) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 3) +
  geom_point(aes(fill = Trait), size = 8, shape = 21, color = "black") +
  # Add red circle highlights
  geom_point(
    data = subset(AllData, sig == TRUE & X != "(Intercept)"),
    aes(x = Avg_Coef, y = X),
    shape = 21, fill = NA, color = "red", size = 11, stroke = 1
  ) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +
  scale_y_discrete(labels = function(x) str_wrap(x, width = 15)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme_minimal() +
  theme(
    panel.spacing.x = unit(2, "lines"),
    # Facet header (strip) styling
    strip.text = element_text(size = 30, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    
    axis.title.x = element_text(margin = margin(t = 15)),  # move x-title down
    axis.title.y = element_text(margin = margin(r = 15)), # move y-title over
    
    # General text/axes
    axis.text = element_text(size = 24, color = "black"),
    axis.title = element_text(size = 30, face = "bold"),
    
    # Panel outlines
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    
    # Grid + spacing tweaks
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    
    # Remove legend
    legend.position = "none"
  )

coef_plot2

#### Add A, B, C labels to each panel
# Create a small data frame of facet labels
facet_labels <- data.frame(
  Trait = c("Body size", "Energy density", "Total energy"),  # must match your facet variable names exactly
  label = c("a", "b", "c"),
  x = Inf,
  y = -Inf
)

RTGplot <- coef_plot2 +
  geom_text(
    data = facet_labels,
    aes(x = x, y = y, label = label),
    hjust = 2, vjust = -1,     # push inward from the edges
    size = 12, fontface = "bold",  # adjust size/style
    inherit.aes = FALSE
  )
RTGplot

#Save coef_plot2 as a jpeg
ggsave(
  filename = "AICFigures/RunTiming_Condition_EstimatesPlot.jpeg",    # output file name
  plot = RTGplot,              # the ggplot object
  width = 20,                     # width in inches
  height = 13,                    # height in inches
  dpi = 300                        # resolution (higher = better quality)
)
```


#Genetic Stock Coefficient Plots
```{r, include = FALSE}
library(dplyr)
library(ggplot2)

rm(list = ls())
#body size, energy, total energy side by side
body <- read.csv("bodysize_GSI/bodysize_GSI_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJkg <- read.csv("energydensity_GSI/EnergyPDry_1_GSI_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJ <- read.csv("totalenergy_GSI/TotalEnergy_GSI_ModelAvg_Coefs_withLikelihoods.csv")



#Look at structure
str(body)
str(energy_mJ)
str(energy_mJkg)

levels(factor(body$X))
body$X <- factor(body$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "Group_AssignmentChitina",
                                "Group_AssignmentKlutinaLake",
                                "Group_AssignmentKlutinaTonsinaOutlet",
                                "Group_AssignmentTazlina",
                                "Group_AssignmentSlana",
                                "Group_AssignmentTanadaCopperLakes",
                                "Group_AssignmentGulkana",
                                "Group_AssignmentGulkanaHatchery",
                                "SexM")))

levels(factor(energy_mJ$X))
energy_mJ$X <- factor(energy_mJ$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "Group_AssignmentChitina",
                                "Group_AssignmentKlutinaLake",
                                "Group_AssignmentKlutinaTonsinaOutlet",
                                "Group_AssignmentTazlina",
                                "Group_AssignmentSlana",
                                "Group_AssignmentTanadaCopperLakes",
                                "Group_AssignmentGulkana",
                                "Group_AssignmentGulkanaHatchery",
                                "SexM")))

levels(factor(energy_mJkg$X))
energy_mJkg$X <- factor(energy_mJkg$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "Group_AssignmentChitina",
                                "Group_AssignmentKlutinaLake",
                                "Group_AssignmentKlutinaTonsinaOutlet",
                                "Group_AssignmentTazlina",
                                "Group_AssignmentSlana",
                                "Group_AssignmentTanadaCopperLakes",
                                "Group_AssignmentGulkana",
                                "Group_AssignmentGulkanaHatchery",
                                "SexM")))


#now data has been restructured for figures, need to remove collection river mile from all structure, does not need to be graphed
body <- body %>%
  filter(X != "Collection_RiverMile_m")
energy_mJ <- energy_mJ %>%
  filter(X != "Collection_RiverMile_m")
energy_mJkg <- energy_mJkg %>%
  filter(X != "Collection_RiverMile_m")


#combine data set according to metric
# Add a variable for dataset type
body$Trait <- "Body size"
energy_mJkg$Trait <- "Energy density"
energy_mJ$Trait <- "Total energy"

# Combine all
AllData <- bind_rows(body, energy_mJkg, energy_mJ)

# Optional: order Trait for facet order
AllData$Trait <- factor(AllData$Trait, levels = c("Body size", "Energy density", "Total energy"))

#Re Labeling
str(AllData)
levels(AllData$X)
levels(AllData$X)[levels(AllData$X) == "SexM"] <- "Male"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentTazlina"] <- "Tazlina"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentTanadaCopperLakes"] <- "Tanada Copper Lakes"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentSlana"] <- "Slana"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentKlutinaTonsinaOutlet"] <- "Klutina Tonsina Outlet"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentKlutinaLake"] <- "Klutina Lake"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentGulkanaHatchery"] <- "Gulkana Hatchery"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentGulkana"] <- "Gulkana"
levels(AllData$X)[levels(AllData$X) == "Group_AssignmentChitina"] <- "Chitina"
AllData

colors <- c(
  "#E69F00", # orange
  "#56B4E9", # sky blue
  "#009E73", # bluish green
  "#F0E442", # yellow
  "#0072B2", # blue
  "#D55E00", # vermillion
  "#CC79A7", # reddish purple
  "#999999"  # gray
)

#plot, basic
coef_plot <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 3, shape = 21, color = "black") +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +  # âœ… call with namespace
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")  # âœ… more space between facets
  )

coef_plot


#plot, coefficients highlighted that don't intersect zero
AllData <- AllData %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))
coef_plot1 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 4, shape = 21, color = "black") +
  # Add red circle highlights
 geom_point(
  data = subset(AllData, sig == TRUE & X != "(Intercept)"),
  aes(x = Avg_Coef, y = X),
  shape = 21, fill = NA, color = "red", size = 6, stroke = 1
) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")
  )

coef_plot1


#better formatting, 
coef_plot2 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 2) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 2) +
  geom_point(aes(fill = Trait), size = 7, shape = 21, color = "black") +
  # Add red circle highlights
  geom_point(
  data = subset(AllData, sig == TRUE & X != "(Intercept)"),
  aes(x = Avg_Coef, y = X),
  shape = 21, fill = NA, color = "red", size = 10, stroke = 1
) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +
  scale_y_discrete(labels = function(x) str_wrap(x, width = 15)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme_minimal() +
   theme(
    panel.spacing.x = unit(2, "lines"),
    # Facet header (strip) styling
    strip.text = element_text(size = 30, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    
    axis.title.x = element_text(margin = margin(t = 15)),  # move x-title down
    axis.title.y = element_text(margin = margin(r = 15)), # move y-title over
    
    # General text/axes
    axis.text = element_text(size = 24, color = "black"),
    axis.title = element_text(size = 30, face = "bold"),
    
    # Panel outlines
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    
    # Grid + spacing tweaks
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    
    # Remove legend
    legend.position = "none"
  )

coef_plot2

#### Add A, B, C labels to each panel
# Create a small data frame of facet labels
facet_labels <- data.frame(
  Trait = c("Body size", "Energy density", "Total energy"),  # must match your facet variable names exactly
  label = c("a", "b", "c"),
  x = Inf,
  y = -Inf
)

GSIplot <- coef_plot2 +
  geom_text(
    data = facet_labels,
    aes(x = x, y = y, label = label),
    hjust = 2, vjust = -1,     # push inward from the edges
    size = 12, fontface = "bold",  # adjust size/style
    inherit.aes = FALSE
  )
GSIplot


# Save coef_plot2 as a jpeg
ggsave(
  filename = "AICFigures/GSI_Condition_EstimatesPlot.jpeg",    # output file name
  plot = GSIplot,              # the ggplot object
  width = 18,                     # width in inches
  height = 12,                    # height in inches
  dpi = 300                        # resolution (higher = better quality)
)
```


#Collection Location Coefficient Plots
```{r, include = FALSE}
library(dplyr)
library(ggplot2)

rm(list = ls())
#body size, energy, total energy side by side
body <- read.csv("bodysize_spawningpopulation/bodysize_spawningpopulation_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJkg <- read.csv("energydensity_spawningpopulation/energydensity_spawningpopulation_ModelAvg_Coefs_withLikelihoods.csv")
energy_mJ <- read.csv("totalenergy_spawningpopulation/TotalEnergy_SP_ModelAvg_Coefs_withLikelihoods.csv")

#Look at structure
str(body)
str(energy_mJ)
str(energy_mJkg)

levels(factor(body$X))
body$X <- factor(body$X,
                 levels = rev(c("(Intercept)", 
                                "Gonad_Wt_g",
                                "Collection_LocationLong Lake",
                                "Collection_LocationSt Anne",
                                "Collection_LocationMahlo",
                                "Collection_LocationMentasta",
                                "Collection_LocationTanada",
                                "Collection_LocationGulkana Hatchery",
                                "SexM",
                                "Year2020",
                                "Year2021",
                                "Collection_LocationGulkana Hatchery:SexM",       
                                "Collection_LocationLong Lake:SexM",
                                "Collection_LocationMahlo:SexM",
                                "Collection_LocationMentasta:SexM",
                                "Collection_LocationSt Anne:SexM",
                                "Collection_LocationTanada:SexM",
                                "SexM:Year2020",
                                "SexM:Year2021")))
     

levels(factor(energy_mJ$X))
energy_mJ$X <- factor(energy_mJ$X,
                 levels = rev(c("(Intercept)", 
                                "Gonad_Wt_g",
                                "Collection_LocationLong Lake",
                                "Collection_LocationSt Anne",
                                "Collection_LocationMahlo",
                                "Collection_LocationMentasta",
                                "Collection_LocationTanada",
                                "Collection_LocationGulkana Hatchery",
                                "SexM",
                                "Year2020",
                                "Year2021",
                                "Collection_LocationGulkana Hatchery:SexM",       
                                "Collection_LocationLong Lake:SexM",
                                "Collection_LocationMahlo:SexM",
                                "Collection_LocationMentasta:SexM",
                                "Collection_LocationSt Anne:SexM",
                                "Collection_LocationTanada:SexM",
                                "SexM:Year2020",
                                "SexM:Year2021")))

levels(factor(energy_mJkg$X))
energy_mJkg$X <- factor(energy_mJkg$X,
                 levels = rev(c("(Intercept)", 
                                "Gonad_Wt_g",
                                "Collection_LocationLong Lake",
                                "Collection_LocationSt Anne",
                                "Collection_LocationMahlo",
                                "Collection_LocationMentasta",
                                "Collection_LocationTanada",
                                "Collection_LocationGulkana Hatchery",
                                "SexM",
                                "Year2020",
                                "Year2021",
                                "Collection_LocationGulkana Hatchery:SexM",       
                                "Collection_LocationLong Lake:SexM",
                                "Collection_LocationMahlo:SexM",
                                "Collection_LocationMentasta:SexM",
                                "Collection_LocationSt Anne:SexM",
                                "Collection_LocationTanada:SexM",
                                "SexM:Year2020",
                                "SexM:Year2021")))


#now data has been restructured for figures, need to remove collection river mile from all structure, does not need to be graphed
body <- body %>%
  filter(X != "Gonad_Wt_g")
energy_mJ <- energy_mJ %>%
  filter(X != "Gonad_Wt_g")
energy_mJkg <- energy_mJkg %>%
  filter(X != "Gonad_Wt_g")


#combine data set according to metric
# Add a variable for dataset type
body$Trait <- "Body size"
energy_mJkg$Trait <- "Energy density"
energy_mJ$Trait <- "Total energy"

# Combine all
AllData <- bind_rows(body, energy_mJkg, energy_mJ)

# Optional: order Trait for facet order
AllData$Trait <- factor(AllData$Trait, levels = c("Body size", "Energy density", "Total energy"))

#Re Labeling
str(AllData)
levels(AllData$X)
levels(AllData$X)[levels(AllData$X) == "SexM"] <- "Male"
levels(AllData$X)[levels(AllData$X) == "Collection_LocationSt Anne"] <- "St Anne"
levels(AllData$X)[levels(AllData$X) == "Collection_LocationMahlo"] <- "Mahlo"
levels(AllData$X)[levels(AllData$X) == "Collection_LocationMentasta"] <- "Mentasta"
levels(AllData$X)[levels(AllData$X) == "Collection_LocationTanada"] <- "Tanada"
levels(AllData$X)[levels(AllData$X) == "Collection_LocationLong Lake"] <- "Long Lake"
levels(AllData$X)[levels(AllData$X) == "Collection_LocationGulkana Hatchery"] <- "Gulkana Hatchery"
levels(AllData$X)[levels(AllData$X) == "Year2020"] <- "2020"
levels(AllData$X)[levels(AllData$X) == "Year2021"] <- "2021"
AllData

colors <- c(
  "#E69F00", # orange
  "#56B4E9", # sky blue
  "#009E73", # bluish green
  "#F0E442", # yellow
  "#0072B2", # blue
  "#D55E00", # vermillion
  "#CC79A7", # reddish purple
  "#999999"  # gray
)

#eliminates interactions
AllData <- AllData %>%
  filter(!grepl(":", X))

#plot, basic
coef_plot <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 3, shape = 21, color = "black") +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +  # âœ… call with namespace
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")  # âœ… more space between facets
  )

coef_plot


#plot, coefficients highlighted that don't intersect zero
AllData <- AllData %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))
coef_plot1 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 1) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 1) +
  geom_point(aes(fill = Trait), size = 4, shape = 21, color = "black") +
  # Add red circle highlights
 geom_point(
  data = subset(AllData, sig == TRUE & X != "(Intercept)"),
  aes(x = Avg_Coef, y = X),
  shape = 21, fill = NA, color = "red", size = 6, stroke = 1
) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.01)) +
  labs(x = "Coefficient Estimate", y = "Parameter") +
  theme_minimal(base_size = 16) +
  theme(
    strip.text = element_text(size = 18, face = "bold"),
    axis.text = element_text(size = 14, color = "black"),
    axis.title = element_text(size = 16, face = "bold"),
    panel.grid.minor = element_blank(),
    legend.position = "none",
    panel.spacing = unit(1.5, "lines")
  )

coef_plot1


#better formatting
coef_plot2 <- ggplot(AllData, aes(x = Avg_Coef, y = X, color = Trait)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 2) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper), height = 0.25, size = 2) +
  geom_point(aes(fill = Trait), size = 7, shape = 21, color = "black") +
  # Add red circle highlights
  geom_point(
  data = subset(AllData, sig == TRUE & X != "(Intercept)"),
  aes(x = Avg_Coef, y = X),
  shape = 21, fill = NA, color = "red", size = 10, stroke = 1
) +
  facet_wrap(~Trait, ncol = 3, scales = "free_x") +
  scale_fill_manual(values = colors) +
  scale_color_manual(values = colors) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.001)) +
  scale_y_discrete(labels = function(x) str_wrap(x, width = 15)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme_minimal() +
   theme(
    panel.spacing.x = unit(2, "lines"),
    # Facet header (strip) styling
    strip.text = element_text(size = 30, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    
    axis.title.x = element_text(margin = margin(t = 15)),  # move x-title down
    axis.title.y = element_text(margin = margin(r = 15)), # move y-title over
    
    # General text/axes
    axis.text = element_text(size = 24, color = "black"),
    axis.title = element_text(size = 30, face = "bold"),
    
    # Panel outlines
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    
    # Grid + spacing tweaks
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    
    # Remove legend
    legend.position = "none"
  )

coef_plot2


#### Add A, B, C labels to each panel
# Create a small data frame of facet labels
facet_labels <- data.frame(
  Trait = c("Body size", "Energy density", "Total energy"),  # must match your facet variable names exactly
  label = c("a", "b", "c"),
  x = Inf,
  y = -Inf
)

SPplot <- coef_plot2 +
  geom_text(
    data = facet_labels,
    aes(x = x, y = y, label = label),
    hjust = 2, vjust = -1,     # push inward from the edges
    size = 12, fontface = "bold",  # adjust size/style
    inherit.aes = FALSE
  )
SPplot

ggsave(
  filename = "AICFigures/SpawningPopulation_Condition_EstimatesPlot.jpeg",    # output file name
  plot = SPplot,              # the ggplot object
  width = 18,                     # width in inches
  height = 12,                    # height in inches
  dpi = 300                        # resolution (higher = better quality)
)
```


### Early and Post Migratory Reproductive Investment Plots
```{r, include = FALSE}
library(dplyr)
library(ggplot2)
library(stringr)

rm(list = ls())
#fecundity and egg size, side by side 
fecundity_rtg <- read.csv("fecundity_runtiminggroup/fecundity~runtiminggroup_models_CoefEstimates_withLikelihoods.csv")
fecundity_gsi <- read.csv("fecundity_GSI/fecundity_GSI_ModelAvg_Coefs_withLikelihoods.csv")
eggsize<- read.csv("eggsize_spawningpopulation/eggsize~spawningpopulation_models_CoefEstimates_withLikelihoods.csv")

#Look at structure
str(fecundity_rtg)
str(fecundity_gsi)
str(eggsize)

levels(factor(fecundity_rtg$X))
fecundity_rtg$X <- factor(fecundity_rtg$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "bodysize_pc",
                                "EnergyPDry_1",
                                "RunTimingGroupMiddle",
                                "RunTimingGroupLate",
                                "Year2020",
                                "Year2021",
                                "EnergyPDry_1:RunTimingGroupLate",
                                "EnergyPDry_1:RunTimingGroupMiddle")))
     

levels(factor(fecundity_gsi$X))
fecundity_gsi$X <- factor(fecundity_gsi$X,
                 levels = rev(c("(Intercept)", 
                                "Collection_RiverMile_m",
                                "bodysize_pc",
                                "EnergyPDry_1",
                                "Group_AssignmentChitina",
                                "Group_AssignmentKlutinaLake",
                                "Group_AssignmentKlutinaTonsinaOutlet",
                                "Group_AssignmentTazlina",
                                "Group_AssignmentSlana",
                                "Group_AssignmentTanadaCopperLakes",
                                "Group_AssignmentGulkana",
                                "Group_AssignmentGulkanaHatchery")))

levels(factor(eggsize$X))
eggsize$X <- factor(eggsize$X,
                 levels = rev(c("(Intercept)", 
                                "Gonad_Wt_g",
                                "bodysize_pc_g_mm",
                                "EnergyPDry_1",
                                "Collection_LocationLong Lake",
                                "Collection_LocationSt Anne",
                                "Collection_LocationMahlo",
                                "Collection_LocationMentasta",
                                "Collection_LocationTanada",
                                "Collection_LocationGulkana Hatchery",
                                "Year2020",
                                "Year2021",
                                "Collection_LocationGulkana Hatchery:SexM",       
                                "Collection_LocationLong Lake:SexM",
                                "Collection_LocationMahlo:SexM",
                                "Collection_LocationMentasta:SexM",
                                "Collection_LocationSt Anne:SexM",
                                "Collection_LocationTanada:SexM"))) #now data has all be re-leveled

#now data has been restructured for figures, need to remove collection river mile from all structure, does not need to be graphed
fecundity_rtg <- fecundity_rtg %>%
  filter(X != "Collection_RiverMile_m")
fecundity_gsi <- fecundity_gsi %>%
  filter(X != "Collection_RiverMile_m")
eggsize <- eggsize %>%
  filter(X != "Gonad_Wt_g")

#filter out interactions
fecundity_rtg <- fecundity_rtg %>%
  filter(!grepl(":", X))
eggsize <- eggsize %>%
  filter(!grepl(":", X))

colors <- c(
  "#E69F00", # orange
  "#56B4E9", # sky blue
  "#009E73", # bluish green
  "#F0E442", # yellow
  "#0072B2", # blue
  "#D55E00", # vermillion
  "#CC79A7", # reddish purple
  "#999999"  # gray
)
#going to use  "#0072B2", # blue for fecundity
#"#CC79A7", # reddish purple for egg size




######============Fecundity RTG plot===================

#Re Labeling
levels(fecundity_rtg$X)
levels(fecundity_rtg$X)[levels(fecundity_rtg$X) == "EnergyPDry_1"] <- "Energy Density"
levels(fecundity_rtg$X)[levels(fecundity_rtg$X) == "bodysize_pc"] <- "Body Size"
levels(fecundity_rtg$X)[levels(fecundity_rtg$X) == "RunTimingGroupMiddle"] <- "Middle Run Timing Group"
levels(fecundity_rtg$X)[levels(fecundity_rtg$X) == "RunTimingGroupLate"] <- "Late Run Timing Group"
levels(fecundity_rtg$X)[levels(fecundity_rtg$X) == "Year2020"] <- "2020"
levels(fecundity_rtg$X)[levels(fecundity_rtg$X) == "Year2021"] <- "2021"
# Add a dummy column for faceting
fecundity_rtg$Facet <- "Fecundity"

fecundity_rtg <- fecundity_rtg %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))

plot_rtg <- ggplot(fecundity_rtg, aes(x = Avg_Coef, y = X)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 2) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper),
                 height = 0.25, size = 2, color = "#0072B2") +
  geom_point(size = 9, shape = 21, fill = "#0072B2", color = "black") +
  geom_point(
    data = subset(fecundity_rtg, sig == TRUE & X != "(Intercept)"),
    aes(x = Avg_Coef, y = X),
    shape = 21, fill = NA, color = "red", size = 12, stroke = 1
  ) + 
  scale_y_discrete(labels = function(x) str_wrap(x, width = 15)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  facet_wrap(~Facet, strip.position = "top") +   # The magic line
  theme_minimal() +
  theme(
    strip.text = element_text(size = 30, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    axis.title.x = element_text(margin = margin(t = 15)),
    axis.title.y = element_text(margin = margin(r = 15)),
    axis.text = element_text(size = 24, color = "black"),
    axis.title = element_text(size = 30, face = "bold"),
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    legend.position = "none"
  )
plot_rtg




######============Fecundity GSI plot===================

#Re Labeling
levels(fecundity_gsi$X)
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "EnergyPDry_1"] <- "Energy Density"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "bodysize_pc"] <- "Body Size"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentTazlina"] <- "Tazlina"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentTanadaCopperLakes"] <- "Tanada Copper Lakes"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentSlana"] <- "Slana"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentGulkanaHatchery"] <- "Gulkana Hatchery"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentGulkana"] <- "Gulkana"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentKlutinaTonsinaOutlet"] <- "Klutina Tonsina Outlet"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentKlutinaLake"] <- "Klutina Lake"
levels(fecundity_gsi$X)[levels(fecundity_gsi$X) == "Group_AssignmentChitina"] <- "Chitina"


# Add a dummy column for faceting
fecundity_gsi$Facet <- "Fecundity"

fecundity_gsi <- fecundity_gsi %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))

plot_gsi <- ggplot(fecundity_gsi, aes(x = Avg_Coef, y = X)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 2) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper),
                 height = 0.25, size = 2, color = "#0072B2") +
  geom_point(size = 9, shape = 21, fill = "#0072B2", color = "black") +
  geom_point(
    data = subset(fecundity_gsi, sig == TRUE & X != "(Intercept)"),
    aes(x = Avg_Coef, y = X),
    shape = 21, fill = NA, color = "red", size = 12, stroke = 1
  ) +
  scale_y_discrete(labels = function(x) str_wrap(x, width = 15)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  facet_wrap(~Facet, strip.position = "top") +   # The magic line
  theme_minimal() +
  theme(
    strip.text = element_text(size = 30, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    axis.title.x = element_text(margin = margin(t = 15)),
    axis.title.y = element_text(margin = margin(r = 15)),
    axis.text = element_text(size = 24, color = "black"),
    axis.title = element_text(size = 30, face = "bold"),
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    legend.position = "none"
  )
plot_gsi



#======================= Plot RTG and GSI fecundity estimate plots side by side =============
library(patchwork)
plot_rtg_tagged <- plot_rtg +
  labs(tag = "a", x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme(plot.tag = element_text(size = 30, face = "bold"),
        plot.tag.position = c(0.97, 0.12),
        plot.margin = margin(5, 20, 5, 5))

plot_gsi_tagged <- plot_gsi +
  labs(tag = "b", x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme(plot.tag = element_text(size = 30, face = "bold"),
        plot.tag.position = c(0.97, 0.12),
        plot.margin = margin(5, 5, 5, 5))

combined_plot <- (plot_rtg_tagged | plot_gsi_tagged) +
  plot_layout(axis_titles = "collect")

combined_plot



# Display
combined_plot



ggsave(
  filename = "AICFigures/RTG_GSI_Fecundity_EstimatesPlot.jpeg",    # output file name
  plot = combined_plot,              # the ggplot object
  width = 18,                     # width in inches
  height = 12,                    # height in inches
  dpi = 300                        # resolution (higher = better quality)
)





#======================== Egg Size Spawning Population Plot ==========================
#Re Labeling
levels(eggsize$X)
levels(eggsize$X)[levels(eggsize$X) == "EnergyPDry_1"] <- "Energy Density"
levels(eggsize$X)[levels(eggsize$X) == "bodysize_pc_g_mm"] <- "Body Size"
levels(eggsize$X)[levels(eggsize$X) == "Year2020"] <- "2020"
levels(eggsize$X)[levels(eggsize$X) == "Year2021"] <- "2021"
levels(eggsize$X)[levels(eggsize$X) == "Collection_LocationGulkana Hatchery"] <- "Gulkana Hatchery"
levels(eggsize$X)[levels(eggsize$X) == "Collection_LocationTanada"] <- "Tanada"
levels(eggsize$X)[levels(eggsize$X) == "Collection_LocationMentasta"] <- "Mentasta"
levels(eggsize$X)[levels(eggsize$X) == "Collection_LocationMahlo"] <- "Mahlo"
levels(eggsize$X)[levels(eggsize$X) == "Collection_LocationSt Anne"] <- "St Anne"
levels(eggsize$X)[levels(eggsize$X) == "Collection_LocationLong Lake"] <- "Long Lake"

# Add a dummy column for faceting
eggsize$Facet <- "Egg size"

eggsize <- eggsize %>%
  mutate(sig = ifelse(CI_Lower > 0 | CI_Upper < 0, TRUE, FALSE))

plot_egg <- ggplot(eggsize, aes(x = Avg_Coef, y = X)) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "grey40", size = 2) +
  geom_errorbarh(aes(xmin = CI_Lower, xmax = CI_Upper),
                 height = 0.25, size = 2, color = "#CC79A7") +
  geom_point(size = 9, shape = 21, fill = "#CC79A7", color = "black") +
  geom_point(
    data = subset(eggsize, sig == TRUE & X != "(Intercept)"),
    aes(x = Avg_Coef, y = X),
    shape = 21, fill = NA, color = "red", size = 12, stroke = 1
  ) + 
  scale_y_discrete(labels = function(x) str_wrap(x, width = 15)) +
  labs(x = "Coefficient Estimate", y = "Main Effect Parameter") +
  facet_wrap(~Facet, strip.position = "top") +   # The magic line
  theme_minimal() +
  theme(
    strip.text = element_text(size = 30, face = "bold", color = "white"),
    strip.background = element_rect(fill = "black", color = "black"),
    axis.title.x = element_text(margin = margin(t = 15)),
    axis.title.y = element_text(margin = margin(r = 15)),
    axis.text = element_text(size = 24, color = "black"),
    axis.title = element_text(size = 30, face = "bold"),
    panel.border = element_rect(color = "black", fill = NA, linewidth = 1),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_line(color = "grey90"),
    panel.spacing = unit(1.5, "lines"),
    legend.position = "none"
  )
plot_egg

ggsave(
  filename = "AICFigures/SP_eggsize_EstimatesPlot.jpeg",    # output file name
  plot = plot_egg,              # the ggplot object
  width = 15,                     # width in inches
  height = 10,                    # height in inches
  dpi = 300                        # resolution (higher = better quality)
)



 #=============== Combining all reproductive metric plots =================
#Don't think I am going to use this, but have it in case Kristen likes it.
library(patchwork)
plot_rtg_tagged <- plot_rtg +
  labs(tag = "a", x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme(plot.tag = element_text(size = 30, face = "bold"),
        plot.tag.position = c(0.97, 0.12),
        plot.margin = margin(5, 10, 5, 5))

plot_gsi_tagged <- plot_gsi +
  labs(tag = "b", x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme(plot.tag = element_text(size = 30, face = "bold"),
        plot.tag.position = c(0.97, 0.12),
        plot.margin = margin(5, 10, 5, 5))

plot_egg_tagged <- plot_egg +
  labs(tag = "c", x = "Coefficient Estimate", y = "Main Effect Parameter") +
  theme(plot.tag = element_text(size = 30, face = "bold"),
        plot.tag.position = c(0.97, 0.12),
        plot.margin = margin(5, 5, 5, 5))

combined_plot <- (plot_rtg_tagged | plot_gsi_tagged | plot_egg_tagged) +
  plot_layout(axis_titles = "collect")

combined_plot



# Display
combined_plot

```

